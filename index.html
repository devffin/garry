<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Garry â€” Messagerie publique</title>

<!-- Firebase compat (HTML simple) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f0f2f5;
}

#app {
  max-width: 900px;
  margin: 20px auto;
  background: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

h1 {
  margin-top: 0;
}

#messages {
  height: 300px;
  overflow-y: auto;
  border: 1px solid #ddd;
  padding: 10px;
  background: #fafafa;
  margin-bottom: 10px;
}

.msg {
  margin-bottom: 6px;
}

.msg b {
  color: #007bff;
}

input, button {
  padding: 8px;
  font-size: 14px;
}

#pseudo {
  width: 150px;
}

#message {
  width: calc(100% - 270px);
}

button {
  background: #007bff;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:hover {
  background: #0056b3;
}
</style>
</head>

<body>

<div id="app">
  <h1>ðŸ’¬ Garry â€” messagerie publique</h1>

  <div id="messages"></div>

  <input id="pseudo" placeholder="Pseudo">
  <input id="message" placeholder="Ã‰cris ton message ici">
  <button onclick="sendMessage()">Envoyer</button>
</div>

<script>
/* ðŸ”¥ Firebase INITIALISATION (TES CLÃ‰S) */
firebase.initializeApp({
  apiKey: "AIzaSyAveVeP0Lk0cESBj20xhhAd3EWMoyuQwMk",
  authDomain: "yotvin-garry.firebaseapp.com",
  databaseURL: "https://yotvin-garry-default-rtdb.firebaseio.com",
  projectId: "yotvin-garry",
  storageBucket: "yotvin-garry.firebasestorage.app",
  messagingSenderId: "306655632884",
  appId: "1:306655632884:web:28f10dc5f309cc7a112da1"
});

/* ðŸ’¬ CHAT PUBLIC */
const db = firebase.database();
const messagesRef = db.ref("messages");

/* pseudo persistant */
const pseudoInput = document.getElementById("pseudo");
pseudoInput.value = localStorage.getItem("garry_pseudo") || "";

/* afficher les messages (historique inclus) */
messagesRef.limitToLast(200).on("child_added", snap => {
  const msg = snap.val();
  const div = document.createElement("div");
  div.className = "msg";
  div.innerHTML = `<b>${msg.pseudo}</b> : ${msg.text}`;
  document.getElementById("messages").appendChild(div);
  document.getElementById("messages").scrollTop =
    document.getElementById("messages").scrollHeight;
});

/* envoyer un message */
function sendMessage() {
  const pseudo = pseudoInput.value.trim() || "Anonyme";
  const text = document.getElementById("message").value.trim();
  if (!text) return;

  localStorage.setItem("garry_pseudo", pseudo);

  messagesRef.push({
    pseudo: pseudo,
    text: text,
    time: Date.now()
  });

  document.getElementById("message").value = "";
}
</script>

</body>
</html>
