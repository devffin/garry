<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Garry â€“ Messages publics</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:0;
}
#container {
  max-width:900px;
  margin:30px auto;
  background:white;
  padding:20px;
  border-radius:10px;
}
#messages {
  height:300px;
  border:1px solid #ccc;
  padding:10px;
  overflow-y:auto;
  background:#fafafa;
}
.msg {
  margin-bottom:5px;
}
input, button {
  padding:8px;
}
button {
  background:#007bff;
  color:white;
  border:none;
  border-radius:5px;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="container">
  <h2>ðŸ’¬ Garry â€“ Mur de messages publics</h2>

  <div id="messages"></div>

  <br>
  <input id="pseudo" placeholder="Pseudo">
  <input id="text" placeholder="Ton message" style="width:60%">
  <button onclick="send()">Envoyer</button>
</div>

<script>
/* ---------- IDENTITÃ‰ ---------- */
let savedPseudo = localStorage.getItem("garry_pseudo");
if(savedPseudo) document.getElementById("pseudo").value = savedPseudo;

/* ---------- FIREBASE ---------- */
firebase.initializeApp({
  apiKey: "TON_API_KEY",
  authDomain: "TON_PROJET.firebaseapp.com",
  databaseURL: "https://TON_PROJET.firebaseio.com",
  projectId: "TON_PROJET",
  storageBucket: "TON_PROJET.appspot.com",
  messagingSenderId: "ID",
  appId: "APP_ID"
});

const db = firebase.database();
const messagesRef = db.ref("public_messages");

/* ---------- CHARGEMENT HISTORIQUE ---------- */
messagesRef
  .limitToLast(100)
  .on("child_added", snapshot => {
    const data = snapshot.val();
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = `<b>${data.pseudo}</b> : ${data.text}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  });

/* ---------- ENVOI MESSAGE ---------- */
function send(){
  const pseudo = document.getElementById("pseudo").value.trim() || "Anonyme";
  const text = document.getElementById("text").value.trim();
  if(!text) return;

  localStorage.setItem("garry_pseudo", pseudo);

  messagesRef.push({
    pseudo: pseudo,
    text: text,
    timestamp: Date.now()
  });

  document.getElementById("text").value = "";
}
</script>

</body>
</html>
